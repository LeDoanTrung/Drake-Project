<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0">

	<title>[[${pageTitle}]]</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-sCl80QlY1uOvghalCOhwVrLrGih5LZgBvJ9+0V0MfArQ2MhU3km6UO7sjizlKY6J5lLbi5jHu9XeRiOAz5dIBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" />
	<link rel="stylesheet" type="text/css" th:href="@{/fontawesome/all.css}" />
	<link rel="stylesheet" type="text/css" th:href="@{/style.css}" />
	<link rel="shortcut icon" href="https://drake.vn/image/catalog/icon-1.png">
	<script type="text/javascript" th:src="@{/webjars/jquery/jquery.min.js}" ></script>
	<script type="text/javascript" th:src="@{/webjars/bootstrap/js/bootstrap.min.js}" ></script>
	<script type="text/javascript" th:src="@{/js/common.js}"></script>
</head>

<style>
	 .rating-stars {
    display: inline-block;
    font-size: 24px;
    color: #ccc;
    cursor: pointer;
	}

	.rating-stars .fa-star {
    transition: all 0.2s;
	}

	.rating-stars .fa-star:hover,
	.rating-stars .fa-star.selected {
		color: #FFD700;
	}


.favorite-div {
  position: relative;
}

.favorite-div:before {
  content: "Thêm vào yêu thích";
  position: absolute;
  top: -25px;
  left: 0;
  width: 100%;
  text-align: center;
  font-size: 14px;
  color: #fff;
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
}

.favorite-div:hover:before {
  opacity: 1;
}

</style>
	
	
	
	
	
	

<body>
<div class="container-fluid">
	<div>
        <form th:action="@{/logout}" method="post" th:hidden="true"
        name="logoutForm">
          <input type="submit">
      </form>
      
      <div>
          <nav class="navbar navbar-expand-lg bg-dark navbar-dark">
              <a th:href="@{/}" class="navbar-brand">
                  <img th:src="@{/images/Logo/drake_logo.png}" alt="" width="100px">
              </a>
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#topNavbar">
                  <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="topNavbar" style="display: flex; justify-content: center; align-items: center;">
                  <ul class="navbar-nav">
                      
                      <th:block sec:authorize="!isAuthenticated()">
                          <li class="nav-item">
                              <a class="nav-link" th:href="@{/login}">Login</a>
                          </li>
                      
                          <li class="nav-item">
                              <a class="nav-link" th:href="@{/register}">Register</a>
                          </li>
                      </th:block>
      
                      <li class="nav-item">
                          <a class="nav-link" th:href="@{/orders}">Orders</a>
                      </li>
                  
					  <li class="nav-item">
                        <a th:href="@{/favorite}" class="nav-link fas fa-heart fa-2x"></a>
						<span id="favoriteCount" class="btn-primary"></span>
                      </li>

                      <li class="nav-item">
                          <a class="nav-link fas fa-shopping-cart fa-2x" th:href="@{/cart}"></a>
                      </li>
      
                      <li class="nav-item">
                          <a class="nav-link" href="">Contact</a>
                      </li>			
                       
                  </ul>
              
  
             
              
              </div>
          </nav>
  
          <div class="drake-logo" style="margin: 20px;">
              <div class="text-center">
                  <a th:href="@{/}" class="navbar-brand">
                      <img th:src="@{/images/Logo/drake_logo.png}" alt="" width="200px">
                  </a>
              </div>
              <div>
                  <hr>
              </div>
              
          </div>
  
          <nav class="navbar navbar-expand-lg bg-dark navbar-dark">
             
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#topNavbar">
                  <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="topNavbar" style="display: flex; justify-content: center; align-items: center;">
                  <ul class="navbar-nav">
  
                       
                          
					<li class="nav-item dropdown" style="font-size: 25px;" >
						<a class="nav-link dropdown-toggle" data-toggle="dropdown" th:href="@{/b/VANS}">VANS</a>
					   <div class="dropdown-menu">
							<a  class="dropdown-item" th:href="@{/b/VANS}">View All</a>
						</div>
				   </li>
				   
			  

			   
				   
					   <li class="nav-item dropdown" style="font-size: 25px;">
						   <a class="nav-link dropdown-toggle" data-toggle="dropdown" th:href="@{/b/CONVERSE}">CONVERSE</a>
						   <div class="dropdown-menu">
							   <a  class="dropdown-item" th:href="@{/b/CONVERSE}">View All</a>
						   </div>
					   </li>
				   
			   

			   
				   
				   <li class="nav-item dropdown" style="font-size: 25px;">
					   <a class="nav-link dropdown-toggle" data-toggle="dropdown" th:href="@{/b/PALLADIUM}">PALLADIUM</a>
					   <div class="dropdown-menu">

						   <a  class="dropdown-item" th:href="@{/b/PALLADIUM}">View All</a>
					   </div>
				   </li>
		   
			 

			   
				   
				   <li class="nav-item dropdown" style="font-size: 25px;">
					   <a class="nav-link dropdown-toggle" data-toggle="dropdown" th:href="@{/b/K-SWISS}">K-SWISS</a>
					   <div class="dropdown-menu">
						   <a  class="dropdown-item" th:href="@{/b/K-SWISS}">View All</a>
					   </div>
				   </li>


				   <li class="nav-item dropdown" style="font-size: 25px;">
					 <a class="nav-link dropdown-toggle" data-toggle="dropdown" th:href="@{/b/SUPRA}">SUPRA</a>
					 <div class="dropdown-menu">
						 <a  class="dropdown-item" th:href="@{/b/SUPRA}">View All</a>
					 </div>
				 </li>
                  
                     
                  </ul>
              
  
             
              
              </div>
          </nav>
      </div> 
    </div>
	<div th:replace="navigation :: search_nav"></div>
	<div th:replace="breadcrumb :: content"></div>

	<div class="row">
		<div class="col-sm">
			<div>
				<img id="bigImage" th:src="@{${product.photosImagePath}}" class="img-fluid" index="0" /><!-- hình to hiển thị ở trên -->
			</div>
			
			<div class="row justify-content-center"><!-- các hình nhỏ hiển thị ở dưới, mainImage ở vị trí đầu tiên, tiếp theo là các extraImages -->
				<div class="m-2 border border-secondary p-1">
					<img class="image-thumbnail" th:src="@{${product.photosImagePath}}" height="50" index="0" />
				</div>
				
				<th:block th:each="extraImage, status : ${product.images}">
					<div class="m-2 border border-secondary p-1">
						<img class="image-thumbnail" th:src="@{${extraImage.imagePath}}" height="50"
							th:index="${status.count}" />
					</div>				
				</th:block>
			</div>
		</div>
		
		<div class="col-sm">
			<div>
				<h2>[[${product.name}]]</h2>
			</div>
			
			<div>
				<span>Brand: [[${product.brand.name}]]</span>
			</div>
			
			<div>
				List Price:
				<span th:if="${product.discountPercent <= 0}">[[${#numbers.formatDecimal(product.price, 1, 'COMMA', 2, 'POINT')}]] VNĐ</span>
				<del th:if="${product.discountPercent > 0}"><span>[[${#numbers.formatDecimal(product.price, 1, 'COMMA', 2, 'POINT')}]] VNĐ</span></del>
			</div>
			
			<div th:if="${product.discountPercent > 0}">
				Price: <span style="font-size: larger; color: darkred">[[${#numbers.formatDecimal(product.discountPrice, 1, 'COMMA', 2, 'POINT')}]] VNĐ</span>
				([[${#numbers.formatDecimal(product.discountPercent, 1, 'COMMA', 2, 'POINT')}]] % off)
			</div>
			
			<div>&nbsp;</div>
			<div th:utext="${product.shortDescription}"></div>	
			<br>
			<br>
			<br>
			<th:block th:if="${product.isShopping == true}">
				<div>
					Please rating your product:
					<br>
					<div class="rating-stars">
						<i class="far fa-star" value="1" data-rating="1"></i>
						<i class="far fa-star" value="2" data-rating="2"></i>
						<i class="far fa-star" value="3" data-rating="3"></i>
						<i class="far fa-star" value="4" data-rating="4"></i>
						<i class="far fa-star" value="5" data-rating="5"></i>
					</div>

				</div>
			</th:block>
		</div>
		
		<div class="col-sm-2">
			<div class="option-box">
				<div class="options">
						<div class="option-item">
							 <div class="form-group required">
								<div class="select-box">
									<select name="option[6303]" id="input-option6303" class="form-control" style="font-weight: bold;">
										<option value="">VUI LÒNG CHỌN SIZE</option>
										<option value="36">36</option>
										<option value="38">38</option>
										<option value="39">39</option>
										<option value="40">40</option>
										<option value="41">41</option>
										<option value="42">42</option>
										<option value="44">44</option>
									</select>
							    </div>
					        </div>
				       </div>
				</div>
			 </div>
	
			
			<span class="huongdanchonsize"><a target="_blank" href="https://drake.vn/huong-dan-cach-do-size-giay"><i class="fa fa-question-circle"></i> Hướng dẫn chọn size</a></span>
			<div>
				<span th:if="${product.inStock}" class="text-success"><b>In Stock</b></span>
				<span th:unless="${product.inStock}" class="text-danger"><b>Out of Stock</b></span>
			</div>
			<br>

			<th:block th:if="${product.star != 0.0}">
				<div class="stars">
					Rating Score: &nbsp;
					 <span>[[${#numbers.formatDecimal(product.averageStar, 1, 'COMMA', 1, 'POINT')}]] / 5.0 <i class="far fa-star" value="1" data-rating="1"></i></span>
				</div>
			</th:block>
				
			
			

			<div class="mt-3 favorite-div">
				<input type="button" value="+ Favourite" id="buttonAdd2Favor" class="btn btn-danger" />

			</div>

			<br>
			<th:block th:if="${product.inStock}"> <!-- nếu inStock = false =>hết product =>ko cho thêm vào cart(giỏ hàng) -->
				<div th:replace="cart/quantity_control :: quantity_control(1, ${product.id})"></div>
				
				<div class="mt-3">
					<input type="button" value="Add to Cart" id="buttonAdd2Cart" class="btn btn-primary" />
				</div>
			</th:block>


		</div>
	</div>
	
	<div class="row">
		<div class="col-12">
			<div><hr/></div>
			<div>
				<h3>Product Description:</h3>
			</div>
			<div th:utext="${product.fullDescription}"></div>
		</div>
	</div>

	<div class="row">
		<div class="col-12">
			<div><hr/></div>
			<div>
				<h3>Product Details:</h3>
			</div>
			<th:block th:each="detail : ${product.details}">
				<div>
					<b>[[${detail.name}]]</b>:
					<span>[[${detail.value}]]</span>
				</div>
			</th:block>
		</div>
	</div>
	
	<div th:replace="product/images_carousel :: content"></div>
	
	<div th:replace="fragments :: modal_dialog"></div>	
	
	<div th:replace="fragments :: footer"></div>
</div>	

<script type="text/javascript">
	productId = "[[${product.id}]]";//sử dụng trong addToCart()
	productAlias = "[[${product.alias}]]"
	contextPath = "[[@{/}]]";//sử dụng trong addToCart()
	var csrfHeaderName = "[[${_csrf.headerName}]]";//X-CSRF-TOKEN, nhấn f12 để xem
	var csrfValue = "[[${_csrf.token}]]";//a11dbd49-400e-481d-b66e-d2c7f66550bc, nhấn f12 để xem
	

	$(document).ready(function() {
		bigImage = $("#bigImage");
		
		$(".image-thumbnail").mouseover(function() {//khi hover vào một hình bất kỳ thì set nội dung của thẻ có id là bigImage thành hình đang hover 
			currentImageSource = $(this).attr("src");//lấy giá trị của thuộc tính src hình đang được hover
			currentImageIndex = $(this).attr("index");//lấy giá trị của thuộc tính index hình đang được hover
			
			bigImage.attr("src", currentImageSource);//gán giá trị của thuộc tính src hình đang được hover cho thuộc tính src của bigImage
			bigImage.attr("index", currentImageIndex);//gán giá trị của thuộc tính index hình đang được hover cho thuộc tính index của bigImage
		});
		
		bigImage.on("click", function() {
			$("#carouselModal").modal("show");//khi click vào một hình bất kỳ thì hiển thị modal
			imageIndex = parseInt(bigImage.attr("index"));//lấy giá trị của thuộc tính index hình đang được click vào
			$("#carouselExampleIndicators").carousel(imageIndex);//carousel có nhiều hình thì nó sẽ hiển thị tại vị trí hình đang click vào
		});

	
	     $('#input-option6302').on('click', 'span', function () {
			 $('#input-option6302 span').removeClass("active");
			$(this).addClass("active");
		  });
										
	});




//Rating

const stars = document.querySelectorAll('.rating-stars .fa-star');
const ratingValue = document.querySelector('#rating-value');

let selectedRating = 0;

stars.forEach((star) => {
    star.addEventListener('mouseover', () => {
        resetSelectedRating();
        const rating = parseInt(star.getAttribute('data-rating'));
        highlightStars(rating);
    });

    star.addEventListener('mouseout', () => {
        resetSelectedRating();
        if (selectedRating !== 0) {
            highlightStars(selectedRating);
        }
    });

    star.addEventListener('click', () => {
        selectedRating = parseInt(star.getAttribute('data-rating'));
        submitRating(selectedRating);
    });
});

function highlightStars(rating) {
    stars.forEach((star) => {
        if (parseInt(star.getAttribute('data-rating')) <= rating) {
            star.classList.add('selected');
        }
    });
}

function resetSelectedRating() {
    stars.forEach((star) => {
        star.classList.remove('selected');
    });
}

function submitRating(rating) {
    url=contextPath+"rating/" + productAlias +"/"+rating;
	$.ajax({
		type: "Post",
		url: url,
		beforeSend: function(xhr){
                xhr.setRequestHeader(csrfHeaderName,csrfValue);
        }
	}).done(function(response){
            showModalDialog("Drake Team", response);
        }).fail(function(){
            showErrorModal("Error while rating this product.")
        });
}
</script>

<script type="text/javascript" th:src="@{/js/jquery.number.min.js}"></script>
<script type="text/javascript" th:src="@{/js/common_modal.js}"></script>
<script type="text/javascript" th:src="@{/js/quantity_control.js}"></script>
<script type="text/javascript" th:src="@{/js/add_to_cart.js}"></script>

</body>
</html>